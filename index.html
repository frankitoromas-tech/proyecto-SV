<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Carta para Luyuromo</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="ambient-glow" aria-hidden="true"></div>

    <main class="stage">
      <section class="letter" aria-label="Carta con mensajes de motivaci√≥n y aprecio">
        <p class="letter-tag">Carta de San Valent√≠n</p>
        <h1 class="title">Luyuromo</h1>
        <p class="intro">
          Estar contigo me inspira: cambia sus palabras para recordarte lo valiosa que eres para mi.
        </p>

        <article class="message-box" id="messageBox" aria-live="polite">
          <h2>Mensaje de hoy</h2>
          <p id="quoteText"></p>
        </article>

        <div class="controls">
          <button id="newMessageBtn" type="button">Nuevo mensaje ‚ú®</button>
          <button id="bloomBtn" type="button">Revivir rosas üåπ</button>
        </div>
      </section>

      <section class="bouquet-scene" aria-label="Ramo de rosas en estilo detallado">
        <div class="paper-backdrop"></div>

        <div class="bouquet" id="bouquet">
          <div class="rose rose-main r1"></div>
          <div class="rose rose-main r2"></div>
          <div class="rose rose-main r3"></div>
          <div class="rose rose-mid r4"></div>
          <div class="rose rose-mid r5"></div>
          <div class="rose rose-bud r6"></div>

          <div class="stem s1"></div>
          <div class="stem s2"></div>
          <div class="stem s3"></div>

          <div class="leaf l1"></div>
          <div class="leaf l2"></div>
          <div class="leaf l3"></div>
        </div>
      </section>
    </main>
<script>
(() => {
  // Evita doble inicializaci√≥n
  if (window.__autoBloomLoaded) return;
  window.__autoBloomLoaded = true;

  const host = document.createElement('div');
  host.id = 'auto-bloom-host';
  host.style.position = 'fixed';
  host.style.top = '0';
  host.style.right = '0';
  host.style.width = '26vw';
  host.style.maxWidth = '360px';
  host.style.height = '100vh';
  host.style.pointerEvents = 'none'; // no bloquea clicks de tu web
  host.style.zIndex = '9999';
  host.style.overflow = 'hidden';
  document.body.appendChild(host);

  const shadow = host.attachShadow({ mode: 'open' });

  const style = document.createElement('style');
  style.textContent = `
    :host { all: initial; }
    .lane {
      position: relative;
      width: 100%;
      height: 100%;
      contain: layout paint style;
    }

    .flower {
      position: absolute;
      bottom: -80px;
      left: var(--x, 50%);
      width: var(--size, 56px);
      height: var(--size, 56px);
      transform: translateX(-50%) rotate(0deg);
      opacity: 0;
      filter: drop-shadow(0 10px 10px rgba(0,0,0,.25));
      animation:
        rise var(--dur, 7s) linear forwards,
        spin var(--spin, 8s) linear infinite;
      will-change: transform, opacity;
    }

    .core {
      position: absolute;
      inset: 36% 36%;
      border-radius: 50%;
      background: radial-gradient(circle at 35% 35%, #ffe9a6, #ffcb52 60%, #d88c00);
      z-index: 3;
      box-shadow: inset 0 0 4px rgba(255,255,255,.7);
    }

    .petal {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 34%;
      height: 58%;
      border-radius: 60% 40% 60% 40%;
      transform-origin: 50% 90%;
      background:
        radial-gradient(circle at 35% 25%, rgba(255,255,255,.85), transparent 45%),
        linear-gradient(160deg, #ff9ac3, #ff3d86 55%, #a10044);
      box-shadow:
        inset -3px -4px 6px rgba(90,0,40,.35),
        inset 2px 2px 4px rgba(255,215,230,.35);
      opacity: .95;
    }

    @keyframes rise {
      0%   { transform: translateX(-50%) translateY(0) scale(.85); opacity: 0; }
      12%  { opacity: .95; }
      100% { transform: translateX(calc(-50% + var(--drift, 0px))) translateY(calc(-110vh)) scale(1.05); opacity: 0; }
    }

    @keyframes spin {
      from { rotate: 0deg; }
      to   { rotate: 360deg; }
    }

    @media (prefers-reduced-motion: reduce) {
      .flower { animation: none; opacity: .6; }
    }
  `;
  shadow.appendChild(style);

  const lane = document.createElement('div');
  lane.className = 'lane';
  shadow.appendChild(lane);

  function createFlower() {
    const flower = document.createElement('div');
    flower.className = 'flower';

    const x = 10 + Math.random() * 80;              // posici√≥n horizontal dentro del carril
    const size = 36 + Math.random() * 52;           // tama√±o variable
    const dur = 5.8 + Math.random() * 4.5;          // velocidad variable
    const spin = 4 + Math.random() * 7;             // giro variable
    const drift = -30 + Math.random() * 60;         // deriva lateral
    const petals = 7 + Math.floor(Math.random() * 4); // 7-10 p√©talos

    flower.style.setProperty('--x', `${x}%`);
    flower.style.setProperty('--size', `${size}px`);
    flower.style.setProperty('--dur', `${dur}s`);
    flower.style.setProperty('--spin', `${spin}s`);
    flower.style.setProperty('--drift', `${drift}px`);

    for (let i = 0; i < petals; i++) {
      const p = document.createElement('span');
      p.className = 'petal';
      const angle = (360 / petals) * i + (Math.random() * 12 - 6);
      p.style.transform = `translate(-50%, -90%) rotate(${angle}deg)`;
      flower.appendChild(p);
    }

    const core = document.createElement('span');
    core.className = 'core';
    flower.appendChild(core);

    lane.appendChild(flower);

    // Limpieza autom√°tica
    setTimeout(() => flower.remove(), (dur + 0.6) * 1000);
  }

  // Florecimientos autom√°ticos y din√°micos
  const baseInterval = 700; // ms
  let timer = null;

  function schedule() {
    createFlower();
    const jitter = Math.random() * 500; // variaci√≥n de frecuencia
    timer = setTimeout(schedule, baseInterval + jitter);
  }

  schedule();

  // API opcional por si luego quieres apagar/encender sin recargar
  window.autoBloom = {
    stop() { if (timer) clearTimeout(timer); timer = null; },
    start() { if (!timer) schedule(); },
    destroy() {
      if (timer) clearTimeout(timer);
      host.remove();
      delete window.__autoBloomLoaded;
      delete window.autoBloom;
    }
  };
})();
</script>

    <script src="script.js"></script>
  </body>
</html>
